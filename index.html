<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>北海道冬旅 | Hokkaido Winter Trip</title>
    <!-- App Aesthetic Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f0f9ff">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Noto Sans TC & Lato (for numbers/time) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base Styles for App feel */
        :root {
            --primary-color: #0ea5e9; /* sky-500 */
            --background-color: #f8fafc; /* slate-50 or f0f9ff for icy blue */
            --card-bg: #ffffff;
            --header-height: 80px;
            --nav-height: 60px;
            --travel-bg: #e0f2fe; /* light blue for travel */
            --travel-border: #93c5fd; /* blue-300 */
        }

        /* Essential Mobile App Shell CSS */
        body { 
            background-color: var(--background-color); 
            color: #334155; 
            font-family: 'Noto Sans TC', sans-serif; 
            padding-top: var(--header-height); /* For fixed header */
            padding-bottom: 90px; /* For fixed bottom nav and safe area */
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            user-select: none; /* Disable text selection for app feel */
        }
        
        /* Header Fix & Style */
        header { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            z-index: 40; 
            background-color: white; /* Solid white background for the fixed header */
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            padding-top: env(safe-area-inset-top); 
            height: var(--header-height);
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding-left: 1rem;
            padding-right: 1rem;
            padding-bottom: 0.75rem;
        }
        
        /* Bottom Nav Fix & Style */
        nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            z-index: 50; 
            background-color: white; 
            border-top: 1px solid #e2e8f0;
            padding-bottom: env(safe-area-inset-bottom); 
        }

        /* General Card & Interaction Styles */
        .card { 
            background: var(--card-bg); 
            border-radius: 16px; 
            margin-bottom: 12px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); 
            border: 1px solid #e0f2fe; 
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .card:not(.no-hover):active { 
            transform: scale(0.99); 
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.05);
        }
        
        /* Travel/Activity Card Styling */
        .activity-card {
            background-color: var(--card-bg);
            border-left: 4px solid var(--primary-color);
            border-color: #cbd5e1; /* slate-300 default */
        }
        .travel-card {
            background-color: var(--travel-bg);
            border-left: 4px solid var(--travel-border);
            border-color: #22c55e; /* green-500 for transit */
        }

        /* Time Highlight - Make it look like a badge */
        .time-highlight { 
            font-weight: 700; 
            color: #0c4a6e; /* dark blue text */
            background-color: #bae6fd; /* sky-200 */
            padding: 4px 8px; 
            border-radius: 8px; 
            font-family: 'Lato', sans-serif; 
            min-width: 70px; /* Wider for better alignment */
            text-align: center; 
            align-self: flex-start;
        }

        /* Input Style */
        .jp-input {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            background-color: #ffffff;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }
        .jp-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }

        /* Navigation */
        .nav-item { color: #94a3b8; transition: color 0.2s; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item:active { transform: scale(0.95); transition: 0.1s; }

        /* Animation Keyframes for Drawer */
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .animate-\[slideUp_0\.3s\] {
            animation: slideUp 0.3s ease-out forwards;
        }
        
        /* Utility Classes */
        .tab-content, .plan-page { display: none; }
        .active { display: block; }
        /* Style for sub-nav buttons when active */
        .sub-nav-item.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }
        .sub-nav-item {
            color: #475569;
            background-color: #e2e8f0;
            transition: all 0.2s;
        }

    </style>
    
    <script type="module">
        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, onSnapshot, doc, addDoc, updateDoc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Global Firebase & Auth State ---
        let db;
        let auth;
        let userId = null;

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'hokkaido-2026';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // --- Toast Logic ---
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const item = document.createElement('div');
            item.className = 'toast-item';
            item.textContent = message;
            if (type === 'error') item.style.backgroundColor = '#ef4444';
            else item.style.backgroundColor = '#22c55e'; // green-500 for success
            
            // Basic toast styling for visibility
            item.style.padding = '10px 15px';
            item.style.borderRadius = '12px';
            item.style.color = 'white';
            item.style.margin = '5px auto';
            item.style.opacity = '0';
            item.style.transition = 'opacity 0.3s, transform 0.3s';
            item.style.transform = 'translateY(20px)';
            item.style.textAlign = 'center';
            item.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';

            container.prepend(item);
            
            setTimeout(() => {
                item.style.opacity = '1';
                item.style.transform = 'translateY(0)';
            }, 10);
            
            setTimeout(() => { 
                item.style.opacity = '0'; 
                item.style.transform = 'translateY(-20px)';
                setTimeout(() => item.remove(), 300); 
            }, 3000);
        }

        // --- Core Functions Export to Window ---
        window.openMap = (q) => { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`, '_blank'); };
        
        window.toggleDrawer = (show) => {
            const d = document.getElementById('expense-drawer');
            d.style.display = show ? "block" : "none";
            if (!show) {
                document.getElementById('exp-name').value = '';
                document.getElementById('exp-amt').value = '';
                // Reset visual style
                document.getElementById('type-cash').checked = true;
                document.getElementById('label-cash').classList.add('active-type');
                document.getElementById('label-credit').classList.remove('active-type');
            }
        };
        
        // --- Expense Logic (Firestore) ---
        window.saveExp = async () => {
            if (!db || !userId) { showToast('錯誤：未連線至雲端。', 'error'); return; }
            const name = document.getElementById('exp-name').value.trim();
            const amount = parseInt(document.getElementById('exp-amt').value);
            const type = document.querySelector('input[name="payment-type"]:checked').value;

            if(!name || isNaN(amount) || amount <= 0) { showToast('請輸入有效內容。', 'error'); return; }
            
            try {
                // Private data storage
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/expenses`), {
                    name, amount, type, timestamp: Date.now()
                });
                showToast('已儲存！');
                window.toggleDrawer(false);
            } catch (e) { console.error(e); showToast('儲存失敗', 'error'); }
        };

        window.delExp = async (id) => {
             // ** IMPORTANT: Custom modal UI is required instead of confirm() **
             if(window.confirm('確定刪除此記錄？')) {
                 try { await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/expenses`, id)); showToast('已刪除'); }
                 catch(e) { console.error(e); }
             }
        };

        window.clearExpHistory = async () => {
             // ** IMPORTANT: Custom modal UI is required instead of confirm() **
             if(window.confirm('確定清除所有記錄？')) {
                 try {
                    const q = query(collection(db, `artifacts/${appId}/users/${userId}/expenses`));
                    const snapshot = await getDocs(q);
                    // Batch deletion is ideal but using loop for simplicity within single-file constraint
                    snapshot.docs.forEach(d => deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/expenses`, d.id)));
                    showToast('已清除');
                 } catch(e) { console.error(e); showToast('清除失敗', 'error'); }
             }
        };

        // --- List Logic (Firestore) ---
        window.addPack = async () => {
            const text = document.getElementById('new-pack').value.trim();
            if(!text || !db) return;
            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/packing`), { text, checked: false, timestamp: Date.now() });
                document.getElementById('new-pack').value = '';
            } catch(e) { console.error(e); showToast('新增打包項目失敗', 'error'); }
        };
        window.togPack = async (id, state) => { 
            if(db) {
                 try { await updateDoc(doc(db, `artifacts/${appId}/users/${userId}/packing`, id), { checked: !state }); }
                 catch(e) { console.error(e); showToast('更新打包狀態失敗', 'error'); }
            }
        };
        window.delPack = async (id) => { 
            if(db) {
                try { await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/packing`, id)); }
                catch(e) { console.error(e); showToast('刪除打包項目失敗', 'error'); }
            }
        };

        window.addMemo = async () => {
            const text = document.getElementById('new-memo').value.trim();
            if(!text || !db) return;
            try {
                await addDoc(collection(db, `artifacts/${appId}/users/${userId}/memos`), { text, timestamp: Date.now() });
                document.getElementById('new-memo').value = '';
                showToast('備忘已新增');
            } catch(e) { console.error(e); showToast('新增備忘失敗', 'error'); }
        };
        window.delMemo = async (id) => { 
            // ** IMPORTANT: Custom modal UI is required instead of confirm() **
            if(db && window.confirm('刪除備忘？')) {
                try { await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/memos`, id)); }
                catch(e) { console.error(e); showToast('刪除備忘失敗', 'error'); }
            }
        };

        // --- Rendering (Data Listeners) ---
        function renderExps(exps) {
            const el = document.getElementById('expense-list');
            el.innerHTML = '';
            const r = parseFloat(document.getElementById('exchange-rate').value) || 0.22;
            let cash = 0, credit = 0;
            
            exps.sort((a,b) => b.timestamp - a.timestamp);
            if(exps.length === 0) el.innerHTML = '<p class="text-center text-gray-400 py-4">尚無記錄</p>';

            exps.forEach(e => {
                const amt = e.amount || 0;
                if(e.type === 'cash') cash += amt; else credit += amt;
                const icon = e.type === 'cash' ? '<span class="text-xs bg-green-100 text-green-700 px-1 rounded-full">現金</span>' : '<span class="text-xs bg-blue-100 text-blue-700 px-1 rounded-full">刷卡</span>';
                
                el.insertAdjacentHTML('beforeend', `
                    <div class="card p-3 flex justify-between items-center shadow-sm">
                        <div class="flex gap-3 items-center flex-1 min-w-0">
                            <div class="w-10 h-10 rounded-lg bg-sky-50 flex items-center justify-center text-sky-500"><i class="fas fa-sack-dollar"></i></div>
                            <div class="truncate">
                                <div class="font-bold text-sm truncate">${e.name}</div>
                                <div class="text-xs text-gray-400">${new Date(e.timestamp).toLocaleDateString()} ${icon}</div>
                            </div>
                        </div>
                        <div class="text-right ml-2">
                            <div class="font-bold text-sm text-slate-800 font-['Lato']">¥${amt.toLocaleString()}</div>
                            <div class="text-xs text-gray-500 font-['Lato']">TWD$${Math.floor(amt*r).toLocaleString()}</div>
                            <button onclick="delExp('${e.id}')" class="text-red-300 hover:text-red-500"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                `);
            });

            // Summary
            const total = cash + credit;
            document.getElementById('expense-list').insertAdjacentHTML('afterbegin', `
                <div class="card p-4 bg-sky-500 text-white mb-4 shadow-lg no-hover">
                    <div class="flex justify-between items-center border-b border-white/30 pb-2 mb-2">
                        <span class="text-sm">總支出 (日圓)</span>
                        <span class="text-2xl font-bold font-['Lato']">¥${total.toLocaleString()}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div><i class="fas fa-money-bill-wave mr-1"></i> 現金: ¥${cash.toLocaleString()}</div>
                        <div><i class="fas fa-credit-card mr-1"></i> 刷卡: ¥${credit.toLocaleString()}</div>
                    </div>
                    <div class="mt-3 pt-2 border-t border-white/30 text-right text-base font-bold">
                        約 TWD$${Math.floor(total*r).toLocaleString()}
                    </div>
                </div>
            `);
        }

        function renderPack(list) {
            const c = document.getElementById('packing-container'); c.innerHTML = '';
            if(list.length===0) c.innerHTML = '<p class="text-center text-gray-400 py-4">清單是空的，點擊下方新增</p>';
            list.sort((a,b) => a.text.localeCompare(b.text));
            list.forEach(i => {
                c.insertAdjacentHTML('beforeend', `
                    <div class="flex items-center justify-between p-3 border-b border-gray-100 cursor-pointer transition duration-100 hover:bg-sky-50" onclick="togPack('${i.id}', ${i.checked})">
                        <div class="flex items-center gap-3">
                            <div class="w-5 h-5 rounded-full border-2 ${i.checked?'bg-green-500 border-green-500':'border-gray-300'} flex items-center justify-center text-white text-xs transition duration-100">${i.checked?'<i class="fas fa-check"></i>':''}</div>
                            <span class="${i.checked?'text-gray-400 line-through':'text-slate-700'}">${i.text}</span>
                        </div>
                        <button onclick="event.stopPropagation();delPack('${i.id}')" class="text-gray-300 hover:text-red-500 transition duration-100"><i class="fas fa-times-circle"></i></button>
                    </div>
                `);
            });
        }

        function renderMemo(list) {
            const c = document.getElementById('memo-container'); c.innerHTML = '';
            if(list.length===0) c.innerHTML = '<p class="text-center text-gray-400 py-4">尚無備忘，點擊下方新增</p>';
            list.sort((a,b) => b.timestamp - a.timestamp);
            list.forEach(m => {
                c.insertAdjacentHTML('beforeend', `
                    <div class="bg-white p-3 rounded-xl shadow-sm border-l-4 border-sky-400 relative mb-3">
                        <p class="whitespace-pre-wrap text-sm text-gray-700">${m.text}</p>
                        <button onclick="delMemo('${m.id}')" class="absolute top-2 right-2 text-gray-300 hover:text-red-400 transition duration-100"><i class="fas fa-times-circle"></i></button>
                    </div>
                `);
            });
        }

        // --- Init ---
        window.onload = function() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        // Start Listeners
                        onSnapshot(query(collection(db, `artifacts/${appId}/users/${userId}/expenses`)), (s) => renderExps(s.docs.map(d=>({id:d.id,...d.data()}))));
                        onSnapshot(query(collection(db, `artifacts/${appId}/users/${userId}/packing`)), (s) => renderPack(s.docs.map(d=>({id:d.id,...d.data()}))));
                        onSnapshot(query(collection(db, `artifacts/${appId}/users/${userId}/memos`)), (s) => renderMemo(s.docs.map(d=>({id:d.id,...d.data()}))));
                        
                        // Display user ID for debugging/sharing
                        document.getElementById('user-id-display').innerText = `使用者ID: ${userId}`;
                    } else {
                        signInAnonymously(auth).catch(console.error);
                    }
                });
            } catch(e) { console.error("Firebase Init Error", e); }

            // Initial UI Setup
            renderAllDayWeather();
            renderPois();
            
            // Initial Nav & View
            nav('plan');
            switchPlanPage('overview');
            document.getElementById('pack-switch').classList.add('bg-sky-50','text-sky-600','font-bold'); // Set initial list view
            document.getElementById('label-cash').classList.add('active-type'); // Set initial radio style
            setTimeout(() => document.getElementById('splash-screen').style.opacity='0', 500);
            setTimeout(() => document.getElementById('splash-screen').style.display='none', 800);
        };
        
        // --- Static Data & Helper Functions (Kept inside script block for file generation mandate) ---
        const weatherData = [
            {day:'Day 1', date:'03/19', icon:'☁️', temp:'3°/8°', loc:'函館'},
            {day:'Day 2', date:'03/20', icon:'☀️', temp:'2°/7°', loc:'洞爺'},
            {day:'Day 3', date:'03/21', icon:'☁️', temp:'1°/6°', loc:'札幌'},
            {day:'Day 4', date:'03/22', icon:'❄️', temp:'-1°/4°', loc:'美瑛'},
            {day:'Day 5', date:'03/23', icon:'☀️', temp:'0°/5°', loc:'小樽'},
            {day:'Day 6', date:'03/24', icon:'✈️', temp:'1°/6°', loc:'千歲'},
        ];
        
        const pois = [
            {n:'函館機場',q:'函館空港'}, {n:'幸運小丑漢堡',q:'幸運小丑漢堡 函館站前店'}, {n:'五稜郭塔',q:'五稜郭塔'},
            {n:'金森紅磚倉庫',q:'金森紅磚倉庫'}, {n:'函館山夜景',q:'函館山ロープウェイ'}, {n:'WE Hotel Toya',q:'WE Hotel Toya'},
            {n:'登別地獄谷',q:'登別地獄谷'}, {n:'尼克斯海洋公園',q:'尼ックス海洋公園'}, {n:'白色戀人公園',q:'白色戀人公園'},
            {n:'旭山動物園',q:'旭山動物園'}, {n:'白鬚瀑布',q:'白鬚瀑布'}, {n:'白金青池',q:'白金青池'},
            {n:'狸小路',q:'狸小路商店街'}, {n:'小樽運河',q:'小樽運河'}, {n:'新千歲機場',q:'新千歲機場'}
        ];

        function renderAllDayWeather() {
            weatherData.forEach((w,i) => {
                const el = document.getElementById(`weather-day-${i+1}`);
                if(el) el.innerHTML = `
                    <div class="flex items-center justify-between bg-gradient-to-r from-sky-400 to-blue-500 text-white p-3 rounded-xl mb-4 shadow-sm no-hover">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${w.icon}</span>
                            <div><div class="text-xs font-bold opacity-90">${w.date} ${w.loc}</div><div class="text-sm font-bold">${w.temp}</div></div>
                        </div>
                        <i class="fas fa-cloud-sun opacity-50"></i>
                    </div>`;
            });
        }

        function renderPois() {
            const c = document.getElementById('poi-quick-links');
            c.innerHTML = pois.map(p => `
                <button onclick="openMap('${p.q}')" class="bg-white p-3 rounded-xl border border-slate-100 shadow-sm text-left transition-transform active:scale-[0.98]">
                    <div class="font-bold text-slate-700 text-sm truncate">${p.n}</div>
                    <div class="text-xs text-sky-500 mt-1"><i class="fas fa-location-arrow mr-1"></i> 導航</div>
                </button>
            `).join('');
        }
        
        window.switchPlanPage = (id) => {
            document.querySelectorAll('.plan-page').forEach(e => e.classList.remove('active'));
            document.getElementById(`plan-page-${id}`).classList.add('active');
            document.querySelectorAll('.sub-nav-item').forEach(e => e.classList.remove('active'));
            document.getElementById(`subnav-${id}`).classList.add('active');
            window.scrollTo(0,0);
        }

        window.switchList = (type) => {
            document.querySelectorAll('#section-lists button[onclick^="switchList"]').forEach(b => b.classList.remove('bg-sky-50','text-sky-600','font-bold'));
            event.currentTarget.classList.add('bg-sky-50','text-sky-600','font-bold');

            document.getElementById('view-packing').style.display = type==='packing'?'block':'none';
            document.getElementById('view-memo').style.display = type==='memo'?'block':'none';
        }

        window.nav = (id) => {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.getElementById(`section-${id}`).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e => {
                e.className = 'nav-item flex flex-col items-center text-slate-400';
            });
            event.currentTarget.className = 'nav-item active flex flex-col items-center text-sky-500';
            window.scrollTo(0,0);
        }

        window.calc = () => {
            const v = document.getElementById('calc-input').value;
            const r = parseFloat(document.getElementById('exchange-rate').value);
            if(v) {
                try {
                    // Sanitize input for safety before execution
                    const safeV = v.replace(/[^-()\d/*+.]/g, '');
                    const res = new Function('return ' + safeV)();
                    document.getElementById('res-twd').innerText = `≈ TWD $${Math.floor(res*r).toLocaleString()}`;
                    document.getElementById('exp-amt').value = Math.floor(res);
                } catch(e){}
            } else {
                document.getElementById('res-twd').innerText = `TWD $0`;
                document.getElementById('exp-amt').value = '';
            }
        };
        // Radio Button Style Logic
        document.addEventListener('DOMContentLoaded', () => {
             document.querySelectorAll('input[name="payment-type"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    document.getElementById('label-cash').classList.remove('active-type');
                    document.getElementById('label-credit').classList.remove('active-type');
                    document.getElementById(`label-${e.target.value}`).classList.add('active-type');
                });
            });
        });
    </script>
</head>
<body>

    <!-- Toast Container (for messages) -->
    <div id="toast-container" class="fixed top-3 z-[9999] w-full max-w-sm left-1/2 -translate-x-1/2"></div>

    <!-- Splash Screen (Snow Fairy Theme) -->
    <div id="splash-screen" class="fixed inset-0 bg-sky-50 z-50 flex flex-col justify-center items-center transition-opacity duration-300 ease-in-out opacity-100">
        <div class="mb-6 animate-pulse">
            <!-- Shima Enaga (Long-tailed Tit) SVG - Snow Fairy -->
            <svg width="140" height="140" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                <!-- Body: Pure White Fluff -->
                <circle cx="256" cy="270" r="170" fill="#ffffff" />
                <!-- Eyes: Dark Blue/Black -->
                <circle cx="190" cy="240" r="18" fill="#1e293b"/>
                <circle cx="322" cy="240" r="18" fill="#1e293b"/>
                <!-- Beak: Small Orange Triangle -->
                <path d="M246 260 L266 260 L256 280 Z" fill="#f59e0b"/>
                <!-- Cheeks: Pinkish Hint -->
                <ellipse cx="170" cy="290" rx="25" ry="15" fill="#fecaca" opacity="0.6"/>
                <ellipse cx="342" cy="290" rx="25" ry="15" fill="#fecaca" opacity="0.6"/>
                <!-- Tail: Long and Black/Grey -->
                <path d="M256 440 Q280 520 200 520" stroke="#334155" stroke-width="20" fill="none" stroke-linecap="round"/>
            </svg>
        </div>
        <h1 class="text-2xl font-bold text-sky-700 tracking-widest">北海道冬旅</h1>
        <p class="text-xs text-sky-500 mt-2 font-mono">Snow Fairy Edition</p>
    </div>

    <!-- Header (Fixed Top) -->
    <header>
        <div>
            <h1 class="text-2xl font-bold text-slate-800">北海道冬旅</h1>
            <p class="text-xs text-slate-400 tracking-wider font-['Lato']">Mar 19 - 24, 2026</p>
        </div>
        <!-- User ID display for collaborative mode -->
        <span id="user-id-display" class="text-[10px] bg-slate-100 text-slate-500 px-2 py-1 rounded-full font-mono max-w-[50%] truncate"></span>
    </header>

    <main class="px-4" id="app">
        
        <!-- SECTION: PLAN -->
        <div id="section-plan" class="tab-content active">
            <!-- Sub Nav (Sticky Top) -->
            <div id="plan-sub-nav" class="sticky top-[var(--header-height)] z-30 bg-white/95 backdrop-blur-sm -mx-4 px-4 border-b border-slate-100 sub-nav-container overflow-x-scroll">
                <div class="inline-flex py-3 gap-2">
                    <button id="subnav-overview" class="sub-nav-item px-4 py-1.5 rounded-full active" onclick="switchPlanPage('overview')">總覽</button>
                    <button id="subnav-day1" class="sub-nav-item px-4 py-1.5 rounded-full" onclick="switchPlanPage('day1')">Day 1</button>
                    <button id="subnav-day2" class="sub-nav-item px-4 py-1.5 rounded-full" onclick="switchPlanPage('day2')">Day 2</button>
                    <button id="subnav-day3" class="sub-nav-item px-4 py-1.5 rounded-full" onclick="switchPlanPage('day3')">Day 3</button>
                    <button id="subnav-day4" class="sub-nav-item px-4 py-1.5 rounded-full" onclick="switchPlanPage('day4')">Day 4</button>
                    <button id="subnav-day5" class="sub-nav-item px-4 py-1.5 rounded-full" onclick="switchPlanPage('day5')">Day 5</button>
                    <button id="subnav-day6" class="sub-nav-item px-4 py-1.5 rounded-full" onclick="switchPlanPage('day6')">Day 6</button>
                </div>
            </div>

            <!-- PAGE: OVERVIEW -->
            <div id="plan-page-overview" class="plan-page active pt-6">
                <div class="card p-6 text-center bg-gradient-to-br from-white to-sky-100 border-sky-200/50 shadow-xl mb-6 no-hover">
                    <div class="mx-auto mb-4 w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg text-3xl border-2 border-sky-200">❄️</div>
                    <h2 class="text-2xl font-bold text-slate-800 mb-1">北海道 6 日周遊</h2>
                    <p class="text-sm text-slate-500">函館 ➔ 洞爺 ➔ 札幌 ➔ 小樽</p>
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide">航班與租車</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="card p-4 border-l-4 border-sky-400">
                            <div class="text-xs font-bold text-sky-500 mb-1">去程 TPE → HKD</div>
                            <div class="font-bold text-xl text-slate-800 font-['Lato']">06:45</div>
                            <div class="text-xs text-slate-500 mb-2">虎航 TTW236</div>
                            <div class="font-bold text-xl text-slate-800 font-['Lato']">11:10</div>
                        </div>
                        <div class="card p-4 border-l-4 border-sky-400">
                            <div class="text-xs font-bold text-sky-500 mb-1">回程 CTS → TPE</div>
                            <div class="font-bold text-xl text-slate-800 font-['Lato']">09:30</div>
                            <div class="text-xs text-slate-500 mb-2">越捷TVJ571</div>
                            <div class="font-bold text-xl text-slate-800 font-['Lato']">13:30</div>
                        </div>
                    </div>
                    <div class="card p-4 border-l-4 border-teal-400 mt-3 no-hover">
                        <div class="text-sm font-bold text-teal-600 mb-1"><i class="fas fa-car mr-1"></i> 租車時間</div>
                        <div class="text-base text-slate-700 font-['Lato']">Day2 09:00 取車 → Day4 19:00 還車</div>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-bold text-slate-400 mb-3 uppercase tracking-wide">住宿 Hotels</h3>
                    <div class="space-y-3">
                        <div class="card p-4 flex gap-4 items-center" onclick="openMap('JR Inn Hakodate')">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500"><i class="fas fa-bed"></i></div>
                            <div>
                                <div class="font-bold text-slate-700">JR INN Hakodate</div>
                                <div class="text-xs text-slate-400">Day 1 (函館)</div>
                            </div>
                        </div>
                        <div class="card p-4 flex gap-4 items-center" onclick="openMap('WE Hotel Toya')">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500"><i class="fas fa-hot-tub"></i></div>
                            <div>
                                <div class="font-bold text-slate-700">WE Hotel Toya</div>
                                <div class="text-xs text-slate-400">Day 2 (洞爺)</div>
                            </div>
                        </div>
                        <div class="card p-4 flex gap-4 items-center" onclick="openMap('Keio Prelia Hotel Sapporo')">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500"><i class="fas fa-city"></i></div>
                            <div>
                                <div class="font-bold text-slate-700">Keio Prelia Hotel Sapporo</div>
                                <div class="text-xs text-slate-400">Day 3-5 (札幌)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: DAY 1 -->
            <div id="plan-page-day1" class="plan-page pt-6">
                <div id="weather-day-1"></div>
                <div class="space-y-4">
                    <!-- Event: Arrival -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-red-500">
                        <div class="time-highlight">11:30</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">抵達函館機場 (HKD)</h4>
                            <p class="text-sm text-slate-500 mt-1">預計 11:10 抵達，準備入境。</p>
                        </div>
                    </div>
                    <!-- Travel: Airport to Hotel -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">30 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-bus-simple mr-1"></i> 函館機場巴士</h4>
                            <p class="text-sm text-green-700 mt-1">前往函館車站，單程約 ¥480。</p>
                            <button onclick="openMap('函館巴士路線')" class="mt-2 text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full"><i class="fas fa-route mr-1"></i>查看路線</button>
                        </div>
                    </div>
                    <!-- Event: Check-in / Lunch -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">13:00</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">JR Inn Hakodate（入住/暫存）</h4>
                            <p class="text-sm text-slate-500 mt-1">將行李寄放在飯店。</p>
                            <button onclick="openMap('JR Inn Hakodate')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full"><i class="fas fa-location-arrow mr-1"></i>導航</button>
                        </div>
                    </div>
                    <!-- Event: Lunch -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-red-400">
                        <div class="time-highlight">13:23</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">幸運小丑漢堡 (午餐)</h4>
                            <p class="text-sm text-slate-500 mt-1">函館站前店，體驗當地名物。</p>
                            <button onclick="openMap('幸運小丑漢堡 函館站前店')" class="mt-2 text-xs bg-red-50 text-red-600 px-3 py-1 rounded-full"><i class="fas fa-utensils mr-1"></i>導航</button>
                        </div>
                    </div>
                    <!-- Travel: Tram to Goryokaku -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">20 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-train-subway mr-1"></i> 函館市電 (路面電車)</h4>
                            <p class="text-sm text-green-700 mt-1">從函館站前搭乘電車至五稜郭公園前站。</p>
                        </div>
                    </div>
                    <!-- Event: Goryokaku Tower -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">14:51</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">五稜郭塔</h4>
                            <p class="text-sm text-slate-500 mt-1">俯瞰星形要塞雪景。</p>
                            <button onclick="openMap('五稜郭塔')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full"><i class="fas fa-eye mr-1"></i>導航</button>
                        </div>
                    </div>
                    <!-- Travel: Tram to Bay Area -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">15 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-train-subway mr-1"></i> 函館市電</h4>
                            <p class="text-sm text-green-700 mt-1">搭乘至十字街站。</p>
                        </div>
                    </div>
                    <!-- Event: Hachiman-zaka Slope -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">16:31</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">八幡坂</h4>
                            <p class="text-sm text-slate-500 mt-1">著名海景坡道，適合拍照。</p>
                            <button onclick="openMap('八幡坂')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full"><i class="fas fa-camera-retro mr-1"></i>導航</button>
                        </div>
                    </div>
                    <!-- Event: Mt. Hakodate Night View -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-yellow-500">
                        <div class="time-highlight">17:05</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">函館山纜車（觀景）</h4>
                            <p class="text-sm text-slate-500 mt-1">等待百萬夜景。</p>
                            <button onclick="openMap('函館山纜車')" class="mt-2 text-xs bg-yellow-50 text-yellow-600 px-3 py-1 rounded-full"><i class="fas fa-star mr-1"></i>導航</button>
                        </div>
                    </div>
                    <!-- Travel: Return to Hotel -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">45 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-taxi mr-1"></i> 電車 + 步行 或 計程車</h4>
                            <p class="text-sm text-green-700 mt-1">觀景後返回飯店休息。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: DAY 2 -->
            <div id="plan-page-day2" class="plan-page pt-6">
                <div id="weather-day-2"></div>
                <div class="space-y-4">
                    <!-- Event: Red Brick Warehouses -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">08:24</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">金森紅磚倉庫</h4>
                            <p class="text-sm text-slate-500 mt-1">晨間散步，港邊倉庫群。</p>
                            <button onclick="openMap('金森紅磚倉庫')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Event: Car Rental -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-teal-500 bg-teal-50">
                        <div class="time-highlight bg-teal-500 text-white">09:00</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-teal-900">租車取車 (函館站前)</h4>
                            <p class="text-sm text-teal-700 mt-1">開始三天的自駕行程。</p>
                        </div>
                    </div>
                    <!-- Travel: Hakodate to Toya -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">3 小時</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 自駕移動</h4>
                            <p class="text-sm text-green-700 mt-1">從函館經高速公路前往洞爺湖，中途可在休息站用餐。</p>
                            <button onclick="openMap('函館到洞爺湖路線')" class="mt-2 text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full"><i class="fas fa-route mr-1"></i>規劃路線</button>
                        </div>
                    </div>
                    <!-- Event: Showa-shinzan Bear Farm -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">12:53</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">昭和新山熊牧場</h4>
                            <p class="text-sm text-slate-500 mt-1">近距離觀賞棕熊。</p>
                            <button onclick="openMap('昭和新山熊牧場')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Event: Usuzan Ropeway -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">13:54</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">洞爺湖有珠山口纜車</h4>
                            <p class="text-sm text-slate-500 mt-1">遠眺洞爺湖全景。</p>
                            <button onclick="openMap('有珠山纜車')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: To Hotel -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">15 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 短程自駕</h4>
                            <p class="text-sm text-green-700 mt-1">沿著湖邊開往旅館。</p>
                        </div>
                    </div>
                    <!-- Event: Hotel Check-in -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-yellow-500">
                        <div class="time-highlight">17:53</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">入住 WE Hotel Toya</h4>
                            <p class="text-sm text-slate-500 mt-1">享用晚餐與溫泉。</p>
                            <button onclick="openMap('WE Hotel Toya')" class="mt-2 text-xs bg-yellow-50 text-yellow-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: DAY 3 -->
            <div id="plan-page-day3" class="plan-page pt-6">
                <div id="weather-day-3"></div>
                <div class="space-y-4">
                    <!-- Travel: Toya to Noboribetsu -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">1.5 小時</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 自駕移動</h4>
                            <p class="text-sm text-green-700 mt-1">從洞爺湖沿路前往登別。</p>
                        </div>
                    </div>
                    <!-- Event: Hell Valley -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">09:33</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">登別地獄谷</h4>
                            <p class="text-sm text-slate-500 mt-1">強烈的硫磺氣味與火山景觀。</p>
                            <button onclick="openMap('登別地獄谷')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: Noboribetsu to NIXE -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">10 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 短程自駕</h4>
                            <p class="text-sm text-green-700 mt-1">移動至海洋公園。</p>
                        </div>
                    </div>
                    <!-- Event: NIXE Ocean Park -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">11:45</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">尼克斯海洋公園 (午餐)</h4>
                            <p class="text-sm text-slate-500 mt-1">歐洲城堡風格，企鵝遊行。</p>
                            <button onclick="openMap('尼克斯海洋公園')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: NIXE to Shiroi Koibito Park -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">1.5 小時</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 自駕移動 (往札幌)</h4>
                            <p class="text-sm text-green-700 mt-1">前往札幌市郊的景點。</p>
                        </div>
                    </div>
                    <!-- Event: Shiroi Koibito Park -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">15:08</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">白色戀人公園</h4>
                            <p class="text-sm text-slate-500 mt-1">札幌近郊歐式餅乾工廠。</p>
                            <button onclick="openMap('白色戀人公園')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: Park to Hotel/Dinner -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">30 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 市區自駕</h4>
                            <p class="text-sm text-green-700 mt-1">開車到札幌車站附近。</p>
                        </div>
                    </div>
                    <!-- Event: Dinner / Hotel -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-yellow-400">
                        <div class="time-highlight">17:01</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">Stellar Place（晚餐/購物）</h4>
                            <p class="text-sm text-slate-500 mt-1">札幌車站上方的百貨公司，並入住飯店。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: DAY 4 -->
            <div id="plan-page-day4" class="plan-page pt-6">
                <div id="weather-day-4"></div>
                <div class="space-y-4">
                    <!-- Event: Long Drive Prep -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-pink-400 bg-pink-50">
                        <div class="time-highlight bg-pink-500 text-white">08:00</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-pink-900">長途自駕日 (往旭川/美瑛)</h4>
                            <p class="text-sm text-pink-700 mt-1">自駕約 2.5 小時，請注意行車安全。</p>
                        </div>
                    </div>
                    <!-- Travel: Sapporo to Asahiyama Zoo -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">2.5 小時</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 自駕移動</h4>
                            <p class="text-sm text-green-700 mt-1">經高速公路前往旭川。</p>
                        </div>
                    </div>
                    <!-- Event: Asahiyama Zoo -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">10:45</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">旭山動物園 (午餐)</h4>
                            <p class="text-sm text-slate-500 mt-1">必看雪地中的動物，注意企鵝散步時間。</p>
                            <button onclick="openMap('旭山動物園')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: Zoo to Shirahige Waterfall -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">1 小時</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 自駕移動</h4>
                            <p class="text-sm text-green-700 mt-1">從旭川開往美瑛白金溫泉區。</p>
                        </div>
                    </div>
                    <!-- Event: Shirahige Waterfall -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">13:57</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">白鬚瀑布</h4>
                            <p class="text-sm text-slate-500 mt-1">青池上游，觀賞冬天結冰的藍色瀑布。</p>
                            <button onclick="openMap('白鬚瀑布')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Event: Blue Pond -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">14:24</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">白金青池</h4>
                            <p class="text-sm text-slate-500 mt-1">冬季可能結冰或有點燈活動 (需確認)。</p>
                            <button onclick="openMap('白金青池')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: Biei to Sapporo (Car Return) -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">2.5 小時</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-car-side mr-1"></i> 自駕回程</h4>
                            <p class="text-sm text-green-700 mt-1">從美瑛返回札幌市區。</p>
                        </div>
                    </div>
                    <!-- Event: Car Return -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-red-500 bg-red-50">
                        <div class="time-highlight bg-red-500 text-white">19:00</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-red-900">札幌車站附近還車</h4>
                            <p class="text-sm text-red-700 mt-1">請務必準時還車！</p>
                        </div>
                    </div>
                    <!-- Event: Tanukikoji -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-yellow-400">
                        <div class="time-highlight">20:00</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">狸小路商店街（晚餐/購物）</h4>
                            <p class="text-sm text-slate-500 mt-1">還車後步行可達。</p>
                            <button onclick="openMap('狸小路商店街')" class="mt-2 text-xs bg-yellow-50 text-yellow-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: DAY 5 -->
            <div id="plan-page-day5" class="plan-page pt-6">
                <div id="weather-day-5"></div>
                <div class="space-y-4">
                    <!-- Travel: JR to Otaru -->
                    <div class="card travel-card p-4 flex gap-4 border-l-4 border-teal-500 bg-teal-50">
                        <div class="time-highlight bg-teal-500 text-white">08:21</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-teal-900"><i class="fas fa-train mr-1"></i> JR 快速列車</h4>
                            <p class="text-sm text-teal-700 mt-1">從札幌站前往小樽，約 40 分鐘。</p>
                        </div>
                    </div>
                    <!-- Event: Otaru Canal -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">10:26</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">小樽運河與周邊</h4>
                            <p class="text-sm text-slate-500 mt-1">運河邊拍照，逛銀之鐘、北一硝子館。</p>
                            <button onclick="openMap('小樽運河')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: JR Back to Sapporo -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">40 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-train mr-1"></i> JR 快速列車</h4>
                            <p class="text-sm text-green-700 mt-1">從小樽返回札幌。</p>
                        </div>
                    </div>
                    <!-- Event: Hokkaido Jingu -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">15:01</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">北海道神宮</h4>
                            <p class="text-sm text-slate-500 mt-1">返回札幌後參拜 (需搭乘地鐵)。</p>
                            <button onclick="openMap('北海道神宮')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Travel: Subway to Ramen -->
                    <div class="card travel-card p-4 flex gap-4">
                        <div class="time-highlight bg-green-200 text-green-800">25 Min</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-green-800"><i class="fas fa-train-subway mr-1"></i> 札幌地下鐵</h4>
                            <p class="text-sm text-green-700 mt-1">移動至晚餐地點。</p>
                        </div>
                    </div>
                    <!-- Event: Dinner -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-red-400">
                        <div class="time-highlight">17:38</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">拉麵 札幌一粒庵（晚餐）</h4>
                            <p class="text-sm text-slate-500 mt-1">享用美味的味噌拉麵。</p>
                            <button onclick="openMap('拉麵 札幌一粒庵')" class="mt-2 text-xs bg-red-50 text-red-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE: DAY 6 -->
            <div id="plan-page-day6" class="plan-page pt-6">
                <div id="weather-day-6"></div>
                <div class="space-y-4">
                     <!-- Travel: Hotel to Airport -->
                    <div class="card travel-card p-4 flex gap-4 border-l-4 border-red-500 bg-red-50">
                        <div class="time-highlight bg-red-500 text-white">06:18</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-red-900"><i class="fas fa-train mr-1"></i> JR 快速機場線</h4>
                            <p class="text-sm text-red-700 mt-1">從札幌站前往新千歲機場 (CTS)，約 37 分鐘。</p>
                        </div>
                    </div>
                    <!-- Event: Airport Check-in -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-sky-500">
                        <div class="time-highlight">07:31</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">抵達新千歲機場</h4>
                            <p class="text-sm text-slate-500 mt-1">辦理登機手續，機場內早餐與最後採購。</p>
                            <button onclick="openMap('新千歲機場')" class="mt-2 text-xs bg-sky-50 text-sky-600 px-3 py-1 rounded-full">導航</button>
                        </div>
                    </div>
                    <!-- Event: Departure -->
                    <div class="card activity-card p-4 flex gap-4 border-l-4 border-red-500">
                        <div class="time-highlight">09:30</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800">✈️ 越捷TVJ571 起飛返台</h4>
                            <p class="text-sm text-slate-500 mt-1">預計 13:30 抵達桃園國際機場。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION: GUIDE -->
        <div id="section-guide" class="tab-content">
            <h2 class="text-xl font-bold text-slate-800 mb-4 border-l-4 border-sky-500 pl-3">景點快速導航</h2>
            <div class="grid grid-cols-2 gap-3" id="poi-quick-links"></div>
        </div>

        <!-- SECTION: UTIL -->
        <div id="section-util" class="tab-content">
            <h2 class="text-xl font-bold text-slate-800 mb-4 border-l-4 border-sky-500 pl-3">記帳與工具</h2>
            <!-- Calculator -->
            <div class="card bg-slate-50 border-0 mb-4 p-4 no-hover">
                <div class="flex justify-between mb-2">
                    <label class="text-sm font-bold text-slate-500">當前匯率 (日圓兌台幣)</label>
                    <input type="number" id="exchange-rate" value="0.22" class="w-16 bg-transparent border-b border-slate-300 text-right text-sm font-['Lato']" oninput="window.calc()">
                </div>
                <div class="flex gap-2 items-center">
                    <input type="text" id="calc-input" placeholder="¥ 輸入金額或算式 (e.g. 500+2500)" class="jp-input text-lg font-bold font-['Lato']" oninput="window.calc()">
                </div>
                <div class="text-right mt-2 text-sky-500 text-lg font-bold font-['Lato']" id="res-twd">TWD $0</div>
            </div>
            
            <button onclick="toggleDrawer(true)" class="w-full bg-white border-2 border-dashed border-sky-300 text-sky-600 py-3 rounded-xl mb-6 font-bold hover:bg-sky-50 transition-colors">
                <i class="fas fa-plus mr-1"></i> 新增消費
            </button>

            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-slate-700">消費明細</h3>
                <button onclick="clearExpHistory()" class="text-xs text-red-400 hover:text-red-600 transition-colors"><i class="fas fa-trash-alt"></i> 清除歷史</button>
            </div>
            <div id="expense-list" class="space-y-2 pb-20"></div>
        </div>

        <!-- SECTION: LISTS -->
        <div id="section-lists" class="tab-content">
            <h2 class="text-xl font-bold text-slate-800 mb-4 border-l-4 border-green-500 pl-3">清單</h2>
            <div class="card p-0 overflow-hidden no-hover">
                <div class="flex border-b border-slate-100">
                    <button id="pack-switch" onclick="switchList('packing')" class="flex-1 py-3 text-sm transition-colors">行李清單</button>
                    <button id="memo-switch" onclick="switchList('memo')" class="flex-1 py-3 text-sm transition-colors">備忘錄</button>
                </div>
                
                <div id="view-packing" class="p-4">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-sm font-bold text-slate-500">極地裝備清單 (建議)</h4>
                        <span class="text-xs text-gray-400">點擊項目打勾/取消</span>
                    </div>
                    <div id="packing-container" class="space-y-1 bg-white rounded-xl overflow-hidden mb-4 border border-gray-100"></div>
                    <div class="flex gap-2">
                        <input id="new-pack" class="jp-input text-sm" placeholder="新增待打包項目...">
                        <button onclick="addPack()" class="bg-sky-500 text-white w-10 h-10 rounded-xl hover:bg-sky-600 transition-colors">+</button>
                    </div>
                </div>
                
                <div id="view-memo" class="p-4 hidden">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-sm font-bold text-slate-500">重要資訊備忘</h4>
                        <span class="text-xs text-gray-400">例如: 預約號碼, 備用電話</span>
                    </div>
                    <div id="memo-container" class="space-y-2"></div>
                    <div class="flex gap-2 mt-4">
                        <input id="new-memo" class="jp-input text-sm" placeholder="新增重要備忘...">
                        <button onclick="addMemo()" class="bg-sky-500 text-white w-10 h-10 rounded-xl hover:bg-sky-600 transition-colors">+</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Nav (Fixed Bottom) -->
    <nav>
        <div class="flex justify-around items-center h-[var(--nav-height)]">
            <button onclick="nav('plan')" class="nav-item flex flex-col items-center">
                <i class="fas fa-calendar-alt text-xl"></i><span class="text-[10px] mt-1">行程</span>
            </button>
            <button onclick="nav('guide')" class="nav-item flex flex-col items-center">
                <i class="fas fa-map-location-dot text-xl"></i><span class="text-[10px] mt-1">導覽</span>
            </button>
            <button onclick="nav('util')" class="nav-item flex flex-col items-center">
                <i class="fas fa-calculator text-xl"></i><span class="text-[10px] mt-1">記帳</span>
            </button>
            <button onclick="nav('lists')" class="nav-item flex flex-col items-center">
                <i class="fas fa-list-check text-xl"></i><span class="text-[10px] mt-1">清單</span>
            </button>
        </div>
    </nav>

    <!-- Expense Drawer (Animated Pop-up) -->
    <div id="expense-drawer" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/40" onclick="toggleDrawer(false)"></div>
        <div class="absolute bottom-0 w-full bg-white rounded-t-3xl p-6 shadow-2xl animate-[slideUp_0.3s] pb-safe">
            <h3 class="font-bold text-center mb-5 text-xl text-slate-800">新增消費記錄</h3>
            
            <div class="flex gap-3 mb-5">
                <!-- Custom Radio Buttons -->
                <label for="type-cash" id="label-cash" class="flex-1 text-center border-2 rounded-xl p-3 cursor-pointer transition-all duration-200">
                    <input type="radio" name="payment-type" id="type-cash" value="cash" class="hidden" checked> <i class="fas fa-money-bill-wave mr-1"></i> 現金
                </label>
                <label for="type-credit" id="label-credit" class="flex-1 text-center border-2 rounded-xl p-3 cursor-pointer transition-all duration-200">
                    <input type="radio" name="payment-type" id="type-credit" value="credit" class="hidden"> <i class="fas fa-credit-card mr-1"></i> 信用卡
                </label>
            </div>
            <style>
                #expense-drawer .active-type {
                    background-color: #f0f9ff; /* sky-50 */
                    border-color: #0ea5e9; /* sky-500 */
                    color: #0ea5e9;
                    font-weight: bold;
                }
            </style>

            <input id="exp-name" class="jp-input mb-3" placeholder="項目名稱 (例如: 晚餐拉麵, 紀念品)">
            <input id="exp-amt" type="number" class="jp-input mb-8 text-2xl font-bold font-['Lato']" placeholder="¥ 金額 (e.g. 3500)">
            <button onclick="saveExp()" class="w-full bg-sky-500 text-white py-4 rounded-2xl font-bold text-lg shadow-xl hover:bg-sky-600 transition-colors">確認儲存</button>
        </div>
    </div>
</body>
</html>